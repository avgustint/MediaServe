<div class="library-editor-container">
  <div class="search-section">
    <div class="search-input-wrapper">
      <input
        type="text"
        class="search-input"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        [placeholder]="'searchLibraryItems' | translate"
      />
      <button *ngIf="searchTerm" class="clear-search-btn" (click)="clearSearch()" [title]="'clearSearch' | translate">
        ×
      </button>
    </div>
    <div class="search-results" *ngIf="showSearchResults">
      <div
        *ngIf="searchResults.length === 0 && searchTerm.trim().length > 0"
        class="no-results"
      >
        {{ 'noLibraryItemsFound' | translate }}
      </div>
      <div
        *ngFor="let result of searchResults"
        class="search-result-item"
        (click)="onSearchResultSelect(result)"
      >
        <div class="search-result-name">{{ result.name }}</div>
        <div class="search-result-type">{{ 'typeColon' | translate }} {{ result.type }}</div>
        <div class="search-result-description" *ngIf="result.description">
          {{ result.description }}
        </div>
      </div>
    </div>
  </div>

  <div class="actions-section">
    <button class="add-button" (click)="addNewItem()" *ngIf="!editingItem && !isNewItem">
      {{ 'addNewLibraryItem' | translate }}
    </button>
  </div>

  <div class="recent-items-section" *ngIf="showRecentItems && !editingItem && !isNewItem && recentItems.length > 0">
    <h3>{{ 'recentlyModified' | translate }}</h3>
    <div class="recent-items-list">
      <div
        *ngFor="let item of recentItems"
        class="recent-item"
        (click)="editItem(item)"
      >
        <div class="item-guid-badge">{{ item.guid }}</div>
        <div class="item-info">
          <div class="item-name">{{ item.name }}</div>
          <div class="item-details">
            <span class="item-type">{{ 'typeColon' | translate }} {{ item.type }}</span>
            <span class="item-separator">•</span>
            <span class="item-modified" *ngIf="item.modified">
              {{ 'modified' | translate }} {{ item.modified | localizedDate:'short' }}
            </span>
          </div>
          <div class="item-description" *ngIf="item.description">
            {{ item.description }}
          </div>
        </div>
        <button
          *ngIf="hasDeletePermission()"
          class="delete-item-btn"
          (click)="deleteItemFromList(item); $event.stopPropagation()"
          [title]="'deleteItem' | translate"
        >
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="edit-section" *ngIf="editingItem || isNewItem">
    <div class="edit-form">
      <h2>{{ isNewItem ? ('addNewLibraryItem' | translate) : ('editLibraryItem' | translate) }}</h2>

      <div class="form-group">
        <label for="itemName">{{ 'name' | translate }} *</label>
        <input
          id="itemName"
          type="text"
          class="form-control"
          [(ngModel)]="itemName"
          [placeholder]="'enterItemName' | translate"
        />
      </div>

      <div class="form-group">
        <label for="itemDescription">{{ 'description' | translate }}</label>
        <input
          id="itemDescription"
          type="text"
          class="form-control"
          [(ngModel)]="itemDescription"
          [placeholder]="'enterItemDescription' | translate"
        />
      </div>

      <div class="form-group">
        <label for="itemType">{{ 'type' | translate }} *</label>
        <select
          id="itemType"
          class="form-control"
          [(ngModel)]="itemType"
          (change)="onTypeChange()"
        >
          <option value="text">{{ 'text' | translate }}</option>
          <option value="image">{{ 'image' | translate }}</option>
          <option value="url">{{ 'url' | translate }}</option>
        </select>
      </div>

      <!-- Text Type Content -->
      <div class="form-group" *ngIf="itemType === 'text'">
        <label>{{ 'contentPages' | translate }}</label>
        <div class="pages-container">
          <div *ngFor="let page of textPages; let i = index" class="page-item">
            <div class="page-header">
              <span class="page-number">{{ 'page' | translate }} {{ page.page }}</span>
              <button
                *ngIf="textPages.length > 1"
                class="remove-page-btn"
                (click)="removePage(page.page)"
                [title]="'removePage' | translate"
              >
                ×
              </button>
            </div>
            <textarea
              class="form-control page-content"
              [(ngModel)]="page.content"
              [placeholder]="('enterContentForPage' | translate) + ' ' + page.page"
              rows="5"
            ></textarea>
          </div>
          <button class="add-page-btn" (click)="addPage()">{{ 'addPage' | translate }}</button>
        </div>
      </div>

      <!-- Image Type Content -->
      <div class="form-group" *ngIf="itemType === 'image'">
        <label>{{ 'imageFile' | translate }} *</label>
        <input
          type="file"
          class="form-control"
          accept="image/*"
          (change)="onImageFileSelected($event)"
        />
        <div *ngIf="imagePreview" class="image-preview">
          <img [src]="imagePreview" [alt]="'preview' | translate" />
        </div>
      </div>

      <!-- URL Type Content -->
      <div class="form-group" *ngIf="itemType === 'url'">
        <label for="urlContent">URL *</label>
        <input
          id="urlContent"
          type="url"
          class="form-control"
          [(ngModel)]="urlContent"
          [placeholder]="'enterUrl' | translate"
        />
      </div>

      <div class="form-actions">
        <button class="btn-save" (click)="saveItem()">
          <i class="fas fa-check"></i>
          <span>{{ 'save' | translate }}</span>
        </button>
        <button class="btn-cancel" (click)="cancelEdit()">
          <i class="fas fa-times"></i>
          <span>{{ 'cancel' | translate }}</span>
        </button>
        <button 
          *ngIf="!isNewItem && editingItem && hasDeletePermission()" 
          class="delete-button" 
          (click)="deleteItem()"
        >
          {{ 'delete' | translate }}
        </button>
      </div>
    </div>
  </div>

  <app-error-popup
    [message]="errorMessage"
    [show]="showError"
    (close)="closeErrorPopup()"
  ></app-error-popup>

  <app-confirm-dialog
    [title]="confirmDialogTitle"
    [message]="confirmDialogMessage"
    [show]="showConfirmDialog"
    [confirmText]="'delete' | translate"
    [cancelText]="'cancel' | translate"
    confirmColor="danger"
    (confirm)="onConfirmDelete()"
    (cancel)="closeConfirmDialog()"
    (close)="closeConfirmDialog()"
  ></app-confirm-dialog>
</div>
