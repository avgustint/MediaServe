<div class="user-profile-container">
  <div class="profile-header">
    <h1>{{ 'userProfile' | translate }}</h1>
  </div>

  <div class="profile-content" *ngIf="user">
    <!-- User Information Display -->
    <div class="info-section" *ngIf="!isEditing && !showPasswordChange">
      <div class="info-item">
        <label>{{ 'name' | translate }}:</label>
        <span>{{ user.name }}</span>
      </div>
      <div class="info-item">
        <label>{{ 'email' | translate }}:</label>
        <span>{{ user.email }}</span>
      </div>
      <div class="info-item">
        <label>{{ 'username' | translate }}:</label>
        <span>{{ user.username }}</span>
      </div>
      <div class="info-item">
        <label>{{ 'role' | translate }}:</label>
        <span>{{ getRoleName() }}</span>
      </div>
      <div class="info-item">
        <label>{{ 'locale' | translate }}:</label>
        <span>{{ user.locale || ('noLocale' | translate) }}</span>
      </div>
      <div class="info-item">
        <label>{{ 'location' | translate }}:</label>
        <span>{{ user.location?.name || ('noLocation' | translate) }}</span>
      </div>

      <div class="action-buttons">
        <button class="btn-primary" (click)="startEdit()">
          <i class="fas fa-edit"></i> {{ 'editProfile' | translate }}
        </button>
        <button class="btn-secondary" (click)="togglePasswordChange()">
          <i class="fas fa-key"></i> {{ 'changePassword' | translate }}
        </button>
      </div>
    </div>

    <!-- Edit Profile Form -->
    <div class="edit-section" *ngIf="isEditing">
      <h2>{{ 'editProfile' | translate }}</h2>
      <form (ngSubmit)="saveProfile()">
        <div class="form-group">
          <label for="editName">{{ 'name' | translate }}:</label>
          <input
            type="text"
            id="editName"
            pInputText
            [(ngModel)]="editName"
            name="editName"
            required
            [placeholder]="'enterUserName' | translate"
            styleClass="w-full"
          />
        </div>
        <div class="form-group">
          <label for="editEmail">{{ 'email' | translate }}:</label>
          <input
            type="email"
            id="editEmail"
            pInputText
            [(ngModel)]="editEmail"
            name="editEmail"
            required
            [placeholder]="'enterUserEmail' | translate"
            styleClass="w-full"
          />
        </div>
        <div class="form-group">
          <label>{{ 'username' | translate }}:</label>
          <input
            type="text"
            pInputText
            [value]="user.username"
            disabled
            class="disabled-input"
            styleClass="w-full"
          />
          <small class="help-text">{{ 'usernameCannotBeChanged' | translate }}</small>
        </div>
        <div class="form-group">
          <label for="editLocale">{{ 'locale' | translate }}:</label>
          <p-select
            id="editLocale"
            [(ngModel)]="editLocale"
            name="editLocale"
            [options]="localeOptions"
            optionLabel="label"
            optionValue="value"
            [placeholder]="'noLocale' | translate"
            styleClass="w-full"
          ></p-select>
        </div>
        <div class="form-group">
          <label for="editLocationId">{{ 'location' | translate }}:</label>
          <p-select
            id="editLocationId"
            [(ngModel)]="editLocationId"
            name="editLocationId"
            [options]="locations"
            optionLabel="name"
            optionValue="guid"
            [placeholder]="loadingLocations ? ('loading' | translate) + '...' : ('selectLocation' | translate)"
            [loading]="loadingLocations"
            [disabled]="loadingLocations"
            styleClass="w-full"
          ></p-select>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-save">
            <i class="fas fa-check"></i>
            <span>{{ 'save' | translate }}</span>
          </button>
          <button type="button" class="btn-cancel" (click)="cancelEdit()">
            <i class="fas fa-times"></i>
            <span>{{ 'cancel' | translate }}</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Change Password Form -->
    <div class="password-section" *ngIf="showPasswordChange">
      <h2>{{ 'changePassword' | translate }}</h2>
      <form (ngSubmit)="changePassword()">
        <div class="form-group">
          <label for="currentPassword">{{ 'currentPassword' | translate }}:</label>
          <p-password
            id="currentPassword"
            [(ngModel)]="currentPassword"
            name="currentPassword"
            [placeholder]="'enterCurrentPassword' | translate"
            [toggleMask]="true"
            [feedback]="false"
            styleClass="w-full"
          ></p-password>
        </div>
        <div class="form-group">
          <label for="newPassword">{{ 'newPassword' | translate }}:</label>
          <p-password
            id="newPassword"
            [(ngModel)]="newPassword"
            name="newPassword"
            [placeholder]="'enterNewPassword' | translate"
            [toggleMask]="true"
            [feedback]="true"
            styleClass="w-full"
          ></p-password>
        </div>
        <div class="form-group">
          <label for="confirmPassword">{{ 'confirmPassword' | translate }}:</label>
          <p-password
            id="confirmPassword"
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            [placeholder]="'enterConfirmPassword' | translate"
            [toggleMask]="true"
            [feedback]="false"
            styleClass="w-full"
          ></p-password>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-save">
            <i class="fas fa-check"></i>
            <span>{{ 'changePassword' | translate }}</span>
          </button>
          <button type="button" class="btn-cancel" (click)="togglePasswordChange()">
            <i class="fas fa-times"></i>
            <span>{{ 'cancel' | translate }}</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Logout Button -->
    <div class="logout-section">
      <button class="btn-logout" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> {{ 'logout' | translate }}
      </button>
    </div>
  </div>
</div>

<!-- Error Popup -->
<app-error-popup
  [message]="errorMessage"
  [show]="showError"
  (close)="closeErrorPopup()"
></app-error-popup>

<!-- Logout Confirmation Dialog -->
<app-confirm-dialog
  [title]="'confirmLogout' | translate"
  [message]="'logoutConfirmMessage' | translate"
  [show]="showLogoutConfirmDialog"
  [confirmText]="'logout' | translate"
  [cancelText]="'cancel' | translate"
  confirmColor="danger"
  (confirm)="onConfirmLogout()"
  (cancel)="closeLogoutConfirmDialog()"
  (close)="closeLogoutConfirmDialog()"
></app-confirm-dialog>

