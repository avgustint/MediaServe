<div class="user-editor-container">
  <div class="search-section">
    <div class="search-input-wrapper">
      <input
        type="text"
        class="search-input"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        placeholder="Search users by name, email, or username..."
      />
      <button *ngIf="searchTerm" class="clear-search-btn" (click)="clearSearch()" title="Clear search">
        ×
      </button>
    </div>
  </div>

  <div class="actions-section">
    <button class="add-button" (click)="addNewUser()" *ngIf="!editingUser && !isNewUser && hasEditUsersPermission">
      Add New User
    </button>
  </div>

  <div class="content-wrapper">
    <div class="users-list-section" *ngIf="!editingUser && !isNewUser">
      <div class="users-list">
        <div
          *ngFor="let user of filteredUsers"
          class="user-item"
          [class.clickable]="hasEditUsersPermission"
          (click)="hasEditUsersPermission && selectUser(user)"
        >
          <div class="user-info">
            <div class="user-name">{{ user.name }}</div>
            <div class="user-details">
              <span class="user-email">{{ user.email }}</span>
              <span class="user-separator">•</span>
              <span class="user-username">{{ user.username }}</span>
              <span class="user-separator">•</span>
              <span class="user-role">{{ getRoleName(user.role) }}</span>
            </div>
          </div>
          <button
            *ngIf="hasEditUsersPermission"
            class="delete-button"
            (click)="deleteUser(user); $event.stopPropagation()"
            title="Delete user"
          >
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="edit-section" *ngIf="editingUser || isNewUser">
      <div class="edit-form">
        <h2>{{ isNewUser ? 'Add New User' : 'Edit User' }}</h2>

        <div class="form-group">
          <label for="userName">Name *</label>
          <input
            id="userName"
            type="text"
            [(ngModel)]="userName"
            placeholder="Enter user name"
            [readonly]="!hasEditUsersPermission"
          />
        </div>

        <div class="form-group">
          <label for="userEmail">Email *</label>
          <input
            id="userEmail"
            type="email"
            [(ngModel)]="userEmail"
            placeholder="Enter email address"
            [readonly]="!hasEditUsersPermission"
          />
        </div>

        <div class="form-group">
          <label for="userUsername">Username *</label>
          <input
            id="userUsername"
            type="text"
            [(ngModel)]="userUsername"
            placeholder="Enter username"
            [readonly]="true"
          />
        </div>

        <div class="form-group" *ngIf="hasEditUsersPermission">
          <label for="userPassword">Password {{ isNewUser ? '*' : '(leave blank to keep current)' }}</label>
          <input
            id="userPassword"
            type="password"
            [(ngModel)]="userPassword"
            placeholder="Enter password"
          />
        </div>

        <div class="form-group">
          <label for="userRole">Role</label>
          <select id="userRole" [(ngModel)]="userRole" [disabled]="!hasEditUsersPermission">
            <option [ngValue]="null">No Role</option>
            <option *ngFor="let role of roles" [ngValue]="role.guid">
              {{ role.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="userLocale">Locale</label>
          <input
            id="userLocale"
            type="text"
            [(ngModel)]="userLocale"
            placeholder="Enter locale (e.g., en-US)"
            [readonly]="!hasEditUsersPermission"
          />
        </div>

        <div class="form-actions" *ngIf="hasEditUsersPermission">
          <button class="save-button" (click)="saveUser()">Save</button>
          <button class="cancel-button" (click)="cancelEdit()">Cancel</button>
        </div>
        <div class="form-actions" *ngIf="!hasEditUsersPermission">
          <button class="cancel-button" (click)="cancelEdit()">Close</button>
        </div>
      </div>
    </div>
  </div>

  <app-error-popup
    *ngIf="showError"
    [message]="errorMessage"
    (close)="closeErrorPopup()"
  ></app-error-popup>
</div>

