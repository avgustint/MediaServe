<div class="general-settings-container">
  <div class="settings-header">
    <h2>{{ 'generalSettings' | translate }}</h2>
  </div>

  <div *ngIf="!hasViewPermission()" class="no-permission">
    <p>{{ 'noPermissionToViewSettings' | translate }}</p>
  </div>

  <div *ngIf="hasViewPermission() && loading" class="loading">
    <p>{{ 'loading' | translate }}...</p>
  </div>

  <div *ngIf="hasViewPermission() && !loading" class="settings-form">
    <div class="form-group">
      <label for="defaultBackgroundColor">{{ 'defaultBackgroundColor' | translate }}</label>
      <div class="color-input-wrapper">
        <input
          type="color"
          id="defaultBackgroundColor"
          [(ngModel)]="settings.defaultBackgroundColor"
          [disabled]="!hasEditPermission()"
        />
        <input
          type="text"
          class="color-text-input"
          [(ngModel)]="settings.defaultBackgroundColor"
          [disabled]="!hasEditPermission()"
          placeholder="#000000"
        />
      </div>
    </div>

    <div class="form-group">
      <label for="defaultFontColor">{{ 'defaultFontColor' | translate }}</label>
      <div class="color-input-wrapper">
        <input
          type="color"
          id="defaultFontColor"
          [(ngModel)]="settings.defaultFontColor"
          [disabled]="!hasEditPermission()"
        />
        <input
          type="text"
          class="color-text-input"
          [(ngModel)]="settings.defaultFontColor"
          [disabled]="!hasEditPermission()"
          placeholder="#FFFFFF"
        />
      </div>
    </div>

    <div class="form-group">
      <label for="defaultBlankPage">{{ 'defaultBlankPage' | translate }}</label>
      
      <!-- Selected item display -->
      <div *ngIf="selectedBlankPageItem" class="selected-item-display">
        <div class="selected-item-info">
          <span class="selected-item-guid">{{ selectedBlankPageItem.guid }}</span>
          <span class="selected-item-name">{{ selectedBlankPageItem.name }}</span>
          <span class="selected-item-type">({{ selectedBlankPageItem.type }})</span>
        </div>
        <div class="selected-item-actions" *ngIf="hasEditPermission()">
          <button
            class="change-selected-btn"
            (click)="changeBlankPage()"
            [title]="'edit' | translate"
          >
            {{ 'edit' | translate }}
          </button>
          <button
            class="clear-selected-btn"
            (click)="clearBlankPage()"
            [title]="'clear' | translate"
          >
            ×
          </button>
        </div>
      </div>

      <!-- Search input -->
      <div *ngIf="!selectedBlankPageItem" class="blank-page-search">
        <div class="search-input-wrapper">
          <input
            type="text"
            class="search-input"
            [(ngModel)]="blankPageSearchTerm"
            (input)="onBlankPageSearchChange()"
            [placeholder]="'searchLibraryItems' | translate"
            [disabled]="!hasEditPermission()"
          />
          <button 
            *ngIf="blankPageSearchTerm" 
            class="clear-search-btn" 
            (click)="clearBlankPageSearch()" 
            [title]="'clearSearch' | translate"
          >
            ×
          </button>
        </div>
        
        <!-- Search results -->
        <div class="search-results" *ngIf="showBlankPageSearchResults">
          <div
            *ngIf="blankPageSearchResults.length === 0 && blankPageSearchTerm.trim().length > 0"
            class="no-results"
          >
            {{ 'noLibraryItemsFound' | translate }}
          </div>
          <div
            *ngFor="let result of blankPageSearchResults"
            class="search-result-item"
            (click)="onBlankPageSearchResultSelect(result)"
          >
            <div class="search-result-name">{{ result.name }}</div>
            <div class="search-result-type">{{ 'typeColon' | translate }} {{ result.type }}</div>
            <div class="search-result-guid">GUID: {{ result.guid }}</div>
          </div>
        </div>
      </div>
      
      <p class="form-help">{{ 'defaultBlankPageHelp' | translate }}</p>
    </div>

    <div class="form-actions" *ngIf="hasEditPermission()">
      <button class="btn-save" (click)="saveSettings()" [disabled]="saving">
        <i class="fas fa-save"></i>
        <span>{{ saving ? ('saving' | translate) : ('save' | translate) }}</span>
      </button>
    </div>
  </div>

  <app-error-popup
    *ngIf="showError"
    [message]="errorMessage"
    (close)="closeErrorPopup()"
  ></app-error-popup>
</div>

